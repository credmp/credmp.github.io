<!DOCTYPE html>
<html lang="en">
<head>
<!-- 21 Dec. 2022 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Advent of CTF - Challenge 10</title>
<meta name="author" content="Arjen Wiersma" />
<meta name="generator" content="Org Mode" />
<meta description='Writings by Arjen'/>
<link rel='alternate' type='application+rss/xml' title='Writings by Arjen' href='/posts/rss.xml'/>
<link rel="stylesheet" href="../../../css/theme.css?v=20216e086cf8a20ead56908f3be0bcda6af2531ec1a68c9058ee7495590f57ea" type="text/css">
</head>
<body>
<main id="content" class="content">
<header>
<h1 class="title">Advent of CTF - Challenge 10</h1>
<p class="subtitle" role="doc-subtitle">&ldquo;Include&rdquo;</p>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org96795da">Challenge</a></li>
<li><a href="#orgbd9b3d3">Solution</a></li>
</ul>
</div>
</nav>

<section id="outline-container-org96795da" class="outline-2">
<h2 id="org96795da">Challenge</h2>
<div class="outline-text-2" id="text-org96795da">
<p>
The challenge today is to get the flag that is in <code>flag.php</code>. Today you will learn:
</p>

<ul class="org-ul">
<li>Local File Inclusions in PHP</li>
<li>Rainbow tables</li>
</ul>
</div>
</section>

<section id="outline-container-orgbd9b3d3" class="outline-2">
<h2 id="orgbd9b3d3">Solution</h2>
<div class="outline-text-2" id="text-orgbd9b3d3">
<blockquote>
<p>
When files are included things can get real messy. The flag is in flag.php.
</p>
</blockquote>

<p>
The key to Local File Inclusions, LFI, is that you trick a program to include a file that is not included under normal circumstances. This challenge revolves around this concept. The challenge starts with an somewhat empty page.
</p>


<figure id="org10e8ffc">
<img src="index_att/santa-book.png" alt="santa-book.png">

<figcaption><span class="figure-number">Figure 1: </span>The start page of the challenge</figcaption>
</figure>

<p>
The challenge said that the flag is in <code>flag.php</code>. Go to the url <code>/flag.php</code> to see if it is available.
</p>


<figure id="org2f5a74b">
<img src="index_att/flag-php.png" alt="flag-php.png">

<figcaption><span class="figure-number">Figure 2: </span>The content of flag.php</figcaption>
</figure>

<p>
The hint on the page is that we as a user need to get promoted. There is no other clue as to what to do next. Browsing the DevTools (F12) will show that there is a cookie called <code>zeroten</code>. The contents is an URL encoded Base64. Decoding it yields a Base64 encode JSON structure, note the <code>eyJ</code>.
</p>

<blockquote>
<p>
eyJwYWdlIjoibWFpbiIsInJvbGUiOiIxMmRlYTk2ZmVjMjA1OTM1NjZhYjc1NjkyYzk5NDk1OTY4Mz
NhZGM5In0=
</p>
</blockquote>

<p>
Decoding the value will show a JSON structure with the keys <code>page</code> and <code>role</code>. The <code>role</code> is encoded. As the hint said it was an include challenge the reasonable thing to do is to change <code>page</code> from <code>main</code> to <code>flag</code>, assuming it will add the <code>.php</code> to it.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 1: </span>The contents of the zeroten cookie</label><pre class="src src-javascript">{<span class="org-string">"page"</span>:<span class="org-string">"main"</span>,<span class="org-string">"role"</span>:<span class="org-string">"12dea96fec20593566ab75692c9949596833adc9"</span>}
</pre>
</div>

<p>
Change the value in the JSON structure and then Base64 encode it again.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 2: </span>The modified JSON structure</label><pre class="src src-javascript">{<span class="org-string">"page"</span>:<span class="org-string">"flag"</span>,<span class="org-string">"role"</span>:<span class="org-string">"12dea96fec20593566ab75692c9949596833adc9"</span>}
</pre>
</div>

<p>
This does indeed include the <code>flag.php</code> into the main page, however it still shows that the user needs to get promoted.
</p>


<figure id="org1037fe6">
<img src="index_att/flag-but-not-yet.png" alt="flag-but-not-yet.png">

<figcaption><span class="figure-number">Figure 1: </span>The flag.php has been included.</figcaption>
</figure>


<p>
The rabbit hole in this challenge is that a seasoned tester might consider type juggling in the PHP language for the hash comparison. This is not the case in this challenge. The hash has to be replaced with something reasonable.
</p>

<p>
Looking up the value on <a href="https://www.hashes.com">hashes.com</a> will reveal that this hash is actually the <code>sha1</code> of the word <code>user</code>. The hash type can be identified by using the <a href="https://hashes.com/en/tools/hash_identifier">hash identifier</a>. Looking up a hash in a list is called a rainbow table, a precomputed list of words and their hashes that you can search without needing to hash it yourself.
</p>


<figure id="org7aeb37b">
<img src="index_att/hashes-com.png" alt="hashes-com.png">

<figcaption><span class="figure-number">Figure 1: </span>The result of lookup on hashes.com</figcaption>
</figure>

<p>
Using CyberChef the value of <code>admin</code> can be passed through the <code>sha1</code> encoder. This will result in <code>d033e22ae348aeb5660fc2140aec35850c4da997</code> as a value. Add the value to the JSON structure.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 1: </span>The modified JSON structure with admin role</label><pre class="src src-javascript">{<span class="org-string">"page"</span>:<span class="org-string">"flag"</span>,<span class="org-string">"role"</span>:<span class="org-string">"d033e22ae348aeb5660fc2140aec35850c4da997"</span>}
</pre>
</div>

<p>
Encoding this structure into Base64 and adding it in the DevTools (F12) will reveal the flag after reloading the webpage.
</p>


<figure id="org3768344">
<img src="index_att/flag.png" alt="flag.png">

<figcaption><span class="figure-number">Figure 1: </span>The flag</figcaption>
</figure>

<p>
Go grab the points and make sure to also share your badge on social media!
</p>


<figure id="org740a40e">
<img src="index_att/badge.png" alt="badge.png">

<figcaption><span class="figure-number">Figure 1: </span>The badge</figcaption>
</figure>

<p>
Go back to the <a href="../../../index.html">homepage</a>.
</p>
</div>
</section>
</main>
<footer id="postamble" class="status">
<p class="author">Author: Arjen Wiersma</p>
<p class="date">Created: 21 Dec. 2022</p>
</footer>
</body>
</html>